# Based off https://github.com/microsoft/omi/tree/master/docker
FROM ubuntu:16.04

ARG rootpassword=newpassword

SHELL ["/bin/bash", "-c"] 
RUN echo root:$rootpassword | chpasswd
RUN apt-get update -y
RUN apt-get install -y apt-transport-https software-properties-common rpm libpam0g-dev libkrb5-dev curl openssl;
RUN curl -sSL https://packages.microsoft.com/keys/microsoft.asc | apt-key add -
RUN apt-add-repository https://packages.microsoft.com/ubuntu/16.04/prod
RUN apt-get update -y
RUN apt-get install -y omi=1.6.8.0 scx
RUN /opt/omi/bin/omiconfigeditor httpport -a 5985 < /etc/opt/omi/conf/omiserver.conf>tmp.conf && mv -f tmp.conf /etc/opt/omi/conf/omiserver.conf
RUN /opt/omi/bin/omiconfigeditor httpsport -a 5986 < /etc/opt/omi/conf/omiserver.conf>tmp.conf && mv -f tmp.conf /etc/opt/omi/conf/omiserver.conf
EXPOSE 5985 5986
ENTRYPOINT /opt/omi/bin/omiserver -d && echo 'Started omi inner docker' && tail -f /var/opt/omi/log/omiserver.log
